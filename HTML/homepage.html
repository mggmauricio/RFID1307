<!DOCTYPE html>
<html>

<head>
  <title>Sala 1307</title>
</head>

<body style="background-color: #EEEEEE; display: flex; align-items: center;
  justify-content: center; font-size: 24px;">

  <span style="color: #003366;">

    <h1 style="text-align: center;">Sala 1307</h1>

    <h3 style="color: #2596be; margin-top: 72px; text-align: center;">Estado da porta:</h3>

    <form
      style="display: flex;flex-direction: column; align-items: center; justify-content: space-between; width: 100%;">
      <button id="DoorStatus" type="button" name="DoorStatus"
        style="height:48px; border: none;border-radius: 8px; width: 100%; color:#ffffffff; font-weight: bold; background-color:#2E8A34;">ABRIR</button>

      <button id="Register" type="button"
        style="height:48px; border: none;border-radius: 8px; width: 100%; margin-top:12px; color:#ffffffff; font-weight: bold;background-color:#7A37A4;">
        Cadastrar/remover cartão
      </button>
    </form>

</body>
<script>
  let RegisterButton = document.getElementById("Register")
  let DoorStatusButton = document.getElementById("DoorStatus")

  // Registrando as funções de click para cada botão
  RegisterButton.addEventListener("click", registerCard);
  DoorStatusButton.addEventListener("click", changeDoorStatus);

  let Socket;

  function init() {
    Socket = new WebSocket("ws://" + window.location.hostname + ":81/");
    Socket.onmessage = function (event) {
      processCommand(event);
    };
  }

  function registerCard() {
    RegisterButton.textContent = "Aproxime o cartão"
    RegisterButton.style.backgroundColor = "rgb(6, 9, 19)"

    const socketMsg = { type: "setRegisterMode", value: true };
    Socket.send(JSON.stringify(socketMsg));
  }

  function setDoorOpened() {
    DoorStatusButton.textContent = "ABRIR"
    DoorStatusButton.style.backgroundColor = "rgb(46, 138, 52)"
    const socketMsg = { type: "DoorOpened", value: true };
    Socket.send(JSON.stringify(socketMsg));
  }
  function setDoorClosed() {
    DoorStatusButton.textContent = "FECHAR"
    DoorStatusButton.style.backgroundColor = "rgb(184, 75, 61)"
    const socketMsg = { type: "DoorOpened", value: false };
    Socket.send(JSON.stringify(socketMsg));
  }

  function isDoorOpen() {
    return DoorStatusButton.textContent === "ABRIR"
  }

  function changeDoorStatus() {
    if (isDoorOpen()) {
      setDoorClosed()
    } else {
      setDoorOpened()
    }
  }

  function updateDoorStatus(toDoorOpened) {
    if (toDoorOpened) {
      setDoorOpened()
    } else {
      setDoorClosed()
    }
  }

  function processCommand(event) {
    let obj = JSON.parse(event.data);
    let type = obj.type;
    console.log({ obj, type })
    if (type.localeCompare("LED_intensity") == 0) {
      let l_LED_intensity = parseInt(obj.value);
      console.log(l_LED_intensity);
      slider.value = l_LED_intensity;
      output.innerHTML = l_LED_intensity;
    }
    else if (type.localeCompare("LED_selected") == 0) {
      let l_LED_selected = parseInt(obj.value);
      console.log(l_LED_selected);
      if (l_LED_selected == 0) {
        document.getElementById("ID_LED_0").checked = true;
      } else if (l_LED_selected == 1) {
        document.getElementById("ID_LED_1").checked = true;
      } else if (l_LED_selected == 2) {
        document.getElementById("ID_LED_2").checked = true;
      }
    }
  }

  window.onload = function (event) {
    init();
  }
</script>

</html>